<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>vre-infra - VRE Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "vre-infra";
        var mkdocs_page_input_path = "vre-infra.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> VRE Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">VRE Charité Repositories</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../helm-charts/">helm-charts</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">vre-infra</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../frontend_vre_home/">frontend_vre_home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_entityinfo/">service_entityinfo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../library_common/">library_common</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_scheduled_tasks/">service_scheduled_tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_dataops_gr/">service_dataops_gr</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_dataops_utility/">service_dataops_utility</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core/">core</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_auth/">service_auth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_download/">service_download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_pipelinewatch/">service_pipelinewatch</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_common/">service_common</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_dataset_neo4j/">service_dataset_neo4j</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_encryption/">service_encryption</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_notification/">service_notification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_approval/">service_approval</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_dataset/">service_dataset</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_provenance/">service_provenance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_upload/">service_upload</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_kg/">service_kg</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_hpc/">service_hpc</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_cataloguing/">service_cataloguing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_queue/">service_queue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../service_logger/">service_logger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docs/">docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release-archive/">release-archive</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../.github/">.github</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Additional Documentation Files</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../vre-infra_DEPLOYMENT/">vre-infra - DEPLOYMENT.md</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docs_vre-documentation/">docs - vre-documentation.md</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">VRE Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">VRE Charité Repositories</li>
      <li class="breadcrumb-item active">vre-infra</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="vre-infra">vre-infra</h1>
<h1 id="vre-infra_1">vre-infra</h1>
<p>Charite VRE Deployment repo for helm charts, config values, etc...</p>
<h2 id="current-workflow">current workflow:</h2>
<ul>
<li>be sure to have the right kubeconfig loaded, default is <code>~/.kube/config</code></li>
<li>test your connection to the cluster <code>kubectl get pods -A</code></li>
</ul>
<hr />
<h2 id="deploy-into-the-cluster">deploy into the cluster</h2>
<ul>
<li><a href="DEPLOYMENT.md">DEPLOYMENT-GUIDE</a></li>
</ul>
<h2 id="to-destoy-current-deployment">to destoy current deployment</h2>
<ul>
<li>switch into the terraform folder</li>
<li>use terraform for deployment, see terraform documentation on how to this, basically it's</li>
<li>terraform destroy</li>
</ul>
<h2 id="coding-style">Coding Style</h2>
<p>This is basically a terraform repository.
There are certain things such as formatting which terraform natively takes care of.
Please run <code>terraform validate</code> and <code>terraform fmt -recursive</code> before commiting code.
Currently, we don't do pipeline checks, but it's very likely we will add this in the future.
We don't do linting at this point, so please try to follow these <a href="https://developer.hashicorp.com/terraform/language/style">official recommendations</a>.</p>
<blockquote>
<p>Use underscores to separate multiple words in (resource) names.</p>
</blockquote>
<h2 id="vault">Vault</h2>
<ul>
<li>added namespace for vault</li>
<li>added helm_release for vault</li>
<li>added values.yaml for fault</li>
<li>disabled developer mode; enabled tls</li>
</ul>
<blockquote>
<p>[!Tip]
To unseal the vault after initial setup, connect to shell of the vault pod. Run <code>vault operator init</code> and save the
listed unseal keys and the initial root token.
To unseal the vault run <code>vault operator unseal</code> at least three times. Each time present another unseal key.
You may need to append <code>-tls-skip-verify</code> after each command, since we are using a self-signed certificate.</p>
</blockquote>
<h2 id="pki-cert-manager-et-al">PKI - Cert-Manager et al.</h2>
<p>We use a self-signed PKI to issue server certificates for the applications deployed to VRE (as of now).
In the following, we roughly depict the dependencies among the involved components and explain the consequences for the
deployment order.</p>
<p>As we rely on cert-manager for the certificate distribution and renewal, we have to install cert-manager first in the
cluster.
Basically, in order to make cert-manager's custom resource definition (crd)s available in the cluster as those need to
be present in the cluster for subsequent <code>terraform plan</code> steps to succeed that want to generate certificate resources
from those crds.</p>
<p>We use trust-manager to make the root certificate available to applications in the cluster such that those applications
can verify the presented server certificate up to the root.
All our server certificates are immediately issued from the root for the sake of simplicity.
Thus, client applications need to know / trust the root certificate otherwise the tls connection attempt to the server
fails.</p>
<p>Minio is such a candidate that needs that kind of trust establishment, for instance.
Operator and tenant communicate and the operator needs to trust the server certificate presented by the tenant.</p>
<p>Furthermore, minio's tenant and operator deployment require their respective server certificates to be present already
in the cluster at deployment time.</p>
<p>Other applications thus far follow standard procedures pretty much and are thus not discussed in detail.
The source code should suffice as documentation.</p>
<h3 id="deployment-order">Deployment order</h3>
<p>Hence, cert-manager et al. have to be rolled-out in the following order:</p>
<ol>
<li><strong>pre-installation</strong>: cert-manager and trust-manager</li>
<li><strong>intermediary-installation</strong>:</li>
<li>the vre root certificate and the cluster issuer (issues new certificates derived from the root)</li>
<li>minio server certificates for both tenant and operator</li>
<li><strong>installation:</strong>:</li>
<li>minio tenant and operator</li>
<li>all other applications that rely on the pki to be fully installed in the cluster</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../helm-charts/" class="btn btn-neutral float-left" title="helm-charts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../frontend_vre_home/" class="btn btn-neutral float-right" title="frontend_vre_home">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../helm-charts/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../frontend_vre_home/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
